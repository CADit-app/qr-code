/**
 * Generate embedded SVG content as TypeScript strings
 * This allows the CADit script to work without needing to fetch SVG files at runtime
 */

const fs = require('fs');
const path = require('path');

const imagesDir = path.join(__dirname, '..', 'images');
const outputFile = path.join(__dirname, '..', 'src', 'embeddedSvgs.ts');

const svgFiles = fs.readdirSync(imagesDir).filter(f => f.endsWith('.svg'));

let content = `/**
 * Embedded SVG content for QR code shapes
 * 
 * This file is auto-generated by scripts/generate-embedded-svgs.js
 * DO NOT EDIT MANUALLY
 * 
 * Run: node scripts/generate-embedded-svgs.js
 */

export const embeddedSvgs: Record<string, string> = {\n`;

for (const file of svgFiles) {
  const filePath = path.join(imagesDir, file);
  const svgContent = fs.readFileSync(filePath, 'utf8').trim();
  const key = file.replace('.svg', '');
  
  // Escape backticks and dollar signs for template literal
  const escaped = svgContent
    .replace(/\\/g, '\\\\')
    .replace(/`/g, '\\`')
    .replace(/\$/g, '\\$');
  
  content += `  '${key}': \`${escaped}\`,\n`;
}

content += `};

/**
 * Get SVG content by name
 */
export function getSvgContent(name: string): string {
  const content = embeddedSvgs[name];
  if (!content) {
    throw new Error(\`Unknown SVG: \${name}. Available: \${Object.keys(embeddedSvgs).join(', ')}\`);
  }
  return content;
}
`;

fs.writeFileSync(outputFile, content);
console.log(`Generated ${outputFile} with ${svgFiles.length} SVG files embedded`);
